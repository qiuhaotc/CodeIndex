<Window x:Class="CodeIndex.VisualStudioExtension.Controls.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="CodeIndex Settings" Height="640" Width="640"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <GroupBox Header="Server Mode" Padding="8" Margin="0 0 0 8">
            <StackPanel Orientation="Horizontal"  >
                <RadioButton Content="Remote" Margin="0 0 20 0" IsChecked="{Binding IsRemoteMode, Mode=TwoWay}"/>
                <RadioButton Content="Local" IsChecked="{Binding IsLocalMode, Mode=TwoWay}"/>
            </StackPanel>
        </GroupBox>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <GroupBox Header="Remote Server" Padding="8" Margin="0 0 0 8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Label Content="Remote Service Url:"/>
                        <Grid Grid.Column="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0" Text="{Binding RemoteServiceUrl, UpdateSourceTrigger=PropertyChanged}"/>
                            <Button Grid.Column="1" Content="Open" Margin="6 0 0 0" Padding="10 2" Command="{Binding OpenRemoteServiceUrlCommand}"/>
                        </Grid>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Local Server" Padding="8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="200"/>
                        </Grid.RowDefinitions>
                        <Label Content="Local Service Url:"/>
                        <TextBox Grid.Column="1" Text="{Binding LocalServiceUrl, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Grid.Column="2" Content="Open" Margin="6 0 0 0" Padding="10 2" Command="{Binding OpenLocalServiceUrlCommand}"/>

                        <Label Grid.Row="1" Content="Install Path:"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding LocalServerInstallPath, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Grid.Row="1" Grid.Column="2" Content="Browse" Margin="6 0 0 0" Padding="10 2" Command="{Binding BrowseInstallPathCommand}"/>

                        <Label Grid.Row="2" Content="Data Directory:"/>
                        <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding LocalServerDataDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Grid.Row="2" Grid.Column="2" Content="Browse" Margin="6 0 0 0" Padding="10 2" Command="{Binding BrowseDataDirCommand}"/>

                        <Label Grid.Row="3" Content="Installed Version:"/>
                        <TextBox Grid.Row="3" Grid.Column="1" IsReadOnly="True" Text="{Binding LocalServerVersion}"/>
                        <Button Grid.Row="3" Grid.Column="2" Content="Download / Update" Margin="6 0 0 0" Padding="10 2" Command="{Binding DownloadOrUpdateCommand}"/>

                        <StackPanel Grid.Row="4" Grid.ColumnSpan="3" Orientation="Vertical" Margin="0 8 0 4">
                            <StackPanel Orientation="Horizontal" Margin="0 0 0 4">
                                <TextBlock Text="Health:" VerticalAlignment="Center" Margin="0 0 4 0"/>
                                <TextBlock Text="{Binding HealthStatus}" FontWeight="Bold"/>
                                <Button Content="Check" Width="60" Margin="12 0 0 0" Command="{Binding CheckHealthCommand}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0 0 0 4">
                                <Button Content="Start" Width="70" Margin="0 0 8 0" Command="{Binding StartServerCommand}" IsEnabled="{Binding CanStart}"/>
                                <Button Content="Stop" Width="70" Margin="0 0 8 0" Command="{Binding StopServerCommand}" IsEnabled="{Binding CanStop}"/>
                                <Button Content="Restart" Width="70" Margin="0 0 8 0" Command="{Binding RestartServerCommand}" IsEnabled="{Binding CanRestart}"/>
                                <Button Content="Refresh Log" Width="90" Command="{Binding RefreshLogCommand}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Download:" Margin="0 0 4 0"/>
                                <ProgressBar Width="200" Height="14" Minimum="0" Maximum="100" Value="{Binding DownloadProgress}"/>
                                <TextBlock Text="{Binding DownloadProgress, StringFormat={}{0:F1}%}" Margin="6 0 0 0"/>
                            </StackPanel>
                        </StackPanel>
                        <GroupBox Grid.Row="5" Grid.ColumnSpan="3" Header="Latest 100 Log Lines" Padding="4">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <TextBox Text="{Binding LogContent}" IsReadOnly="True" TextWrapping="NoWrap" FontFamily="Consolas" FontSize="12" Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}" BorderThickness="0"/>
                            </ScrollViewer>
                        </GroupBox>
                    </Grid>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 12 0 0">
            <Button Content="Save" Width="100" Margin="0 0 8 0" IsDefault="True" Command="{Binding SaveCommand}"/>
            <Button Content="Cancel" Width="100" IsCancel="True"/>
        </StackPanel>
    </Grid>
</Window>